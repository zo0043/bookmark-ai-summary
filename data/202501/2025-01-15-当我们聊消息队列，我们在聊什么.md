# 当我们聊消息队列，我们在聊什么
- URL: https://dolphin7.xyz/2022/01/01/Talk-About-Message-Queue/
- Added At: 2025-01-15 14:07:16
- [Link To Text](2025-01-15-当我们聊消息队列，我们在聊什么_raw.md)

## TL;DR
本文探讨了消息传递模型，分析了消息队列的作用、缺点、可靠性、可用性、性能和设计，并介绍了高级功能。

## Summary
1. **消息传递概述**：
   - **request-response模式**：本地系统与远程系统同步通讯，通过发送消息并等待应答。
   - **one way style模型**：系统间异步交互，发送消息后不等待应答。
   - **松耦合模型**：系统间通过消息传递异步交互，发送消息后不等待应答。
   - **消息传递模型**：分为队列（Queue）和流（Stream），队列是FIFO机制，流是数据序列。

2. **消息队列的作用**：
   - **异步处理**：降低系统间同步通讯的复杂性。
   - **解耦系统**：减少系统间的直接依赖，提高系统的灵活性。
   - **削峰填谷**：平衡系统负载，防止系统过载。

3. **消息队列的缺点**：
   - **维护消息队列**：可能存在消息重复消费、消息丢失、不一致性、可用性问题。

4. **可靠性**：
   - **生产者、代理、消费者链路可靠**：确保消息正确传递。
   - **生产者幂等重试**：防止消息重复。
   - **代理消息可靠存储**：持久化消息，支持多副本和故障转移。
   - **消费者Ack机制**：确保消息正确处理。

5. **可用性**：
   - **代理无状态**：提高系统扩展性和容错性。
   - **消息存储多副本**：防止数据丢失。
   - **故障自动转移**：确保系统在故障时仍能正常工作。

6. **性能**：
   - **顺序写入**：保证消息的顺序。
   - **分区**：提高系统吞吐量。
   - **批量处理**：提高处理效率。
   - **I/O分离**：提高系统性能。
   - **缓存**：减少磁盘I/O操作。
   - **零拷贝**：提高数据传输效率。
   - **数据压缩**：减少存储空间需求。

7. **消息队列设计**：
   - **消息队列**：实现负载均衡，单条消息由一个消费者处理。
   - **主题**：实现发布-订阅模式，一个发布者可以向多个订阅者发送消息。
   - **分区主题**：将主题拆分为多个分区，提高系统吞吐量和可扩展性。
   - **分布式日志系统**：消息队列的底层存储是分布式日志系统，提供高吞吐量和低延迟的数据处理能力。

8. **高级功能**：
   - **顺序保证**：确保消息顺序。
   - **延迟队列**：支持延迟处理消息。
   - **事务消息**：保证消息的原子性。
   - **跨地域复制**：提高系统可用性。
   - **多租户**：支持不同租户的隔离和调整。
