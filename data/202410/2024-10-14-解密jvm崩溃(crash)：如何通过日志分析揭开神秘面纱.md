# 解密JVM崩溃(Crash)：如何通过日志分析揭开神秘面纱
- URL: https://mp.weixin.qq.com/s/_DOQGBmhfV-LUzb03RcTCQ
- Added At: 2024-10-14 15:42:53
- [Link To Text](2024-10-14-解密jvm崩溃(crash)：如何通过日志分析揭开神秘面纱_raw.md)

## TL;DR
本文探讨了JVM崩溃的原因、分析方法和解决策略，通过示例和日志详解展示崩溃现象，强调内存访问和JNI问题，建议掌握JVM机制以降低崩溃风险。

## Summary
1. **JVM崩溃概述**：本文探讨了Java虚拟机（JVM）崩溃的原因、分析方法和解决策略，强调了崩溃对系统稳定性和用户体验的负面影响。

2. **崩溃定义**：崩溃是指系统挂掉，进程消失，需要研发人员像消防员一样迅速分析日志、检查堆栈并解决问题。

3. **崩溃示例**：通过一个使用`sun.misc.Unsafe`类进行非法内存访问的代码示例，展示了JVM崩溃的现象和日志信息。

4. **崩溃日志详解**：
   - **文件路径**：介绍了崩溃日志文件的默认生成路径和自定义路径的方法。
   - **信息摘要**：概述了崩溃日志包含的信息，如异常或信号、版本配置、线程信息、堆摘要、本地库列表等。
   - **头部信息**：解释了崩溃原因、问题帧栈和核心转储文件的重要性。
   - **线程信息**：详细分析了线程类型、状态、信号量概要、寄存器、栈地址、指令上下文、寄存器内容和帧栈明细。
   - **进程信息**：介绍了进程里的线程、虚拟机安全状态、锁和监视器、内存使用摘要和明细、GC辅助模型、polling page、CodeCache和事件分析。
   - **内存映射明细**：解释了内存映射信息的含义和用途。
   - **启动参数和环境变量**：列出了Java进程的启动参数和系统环境变量。
   - **信号处理**：说明了虚拟机对各种信号注册的回调函数。
   - **系统信息**：概述了系统信息概要、系统内存概括和CPU信息概况。

5. **core文件分析**：
   - **问题调用栈**：介绍了使用gdb分析core文件中的调用堆栈信息。
   - **帧快照**：解释了如何查看特定调用帧的寄存器内容。
   - **汇编代码还原**：说明了如何使用gdb还原出问题的上下文和汇编代码。
   - **内存映射**：介绍了如何查看core文件中的内存映射信息。

6. **经验总结**：
   - **崩溃原因分类**：将崩溃原因分为内存非法访问和物理内存不足两种情况。
   - **留意JNI**：强调了在使用JNI时要注意避免潜在的错误和问题。
   - **敢于怀疑**：建议在出现极端问题时考虑JVM自身bug的可能性。

7. **总结**：本文强调了理解和掌握JVM内在机制的重要性，以及通过合理配置、监控和调优策略降低JVM崩溃风险的方法。
