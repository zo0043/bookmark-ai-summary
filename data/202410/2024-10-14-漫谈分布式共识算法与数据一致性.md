# 漫谈分布式共识算法与数据一致性
- URL: https://wingsxdu.com/posts/algorithms/distributed-consensus-and-data-consistent/
- Added At: 2024-10-14 13:42:21
- [Link To Text](2024-10-14-漫谈分布式共识算法与数据一致性_raw.md)

## TL;DR
本文探讨了分布式系统中的共识与一致性，包括FLP、CAP、BASE理论，2PC和3PC原子提交，Paxos、Raft、Zab等容错共识算法，以及拜占庭容错问题。强调了选择合适算法对构建系统的重要性，并指出领域内尚存挑战。

## Summary
1. **共识与一致性**：
   - **不可靠的网络与时钟**：
     - 异步网络中消息可能丢失、延迟，导致顺序冲突。
     - 解决策略：最后写入获胜（LWW），但时钟可能错误。
     - 逻辑时钟比物理时钟更可靠，避免时间排序冲突。
   - **FLP 不可能定理**：
     - 在异步系统模型中，不存在总是能够在有限时间内达成共识的确定性算法。
     - 实际中可通过时钟和超时机制绕过 FLP 定理。
   - **CAP 定理**：
     - 一致性、可用性、分区容错性，最多只能同时满足两项。
     - 在网络分区情况下，选择一致还是可用。
   - **BASE 理论**：
     - 基本可用、软状态、最终一致性。
     - 牺牲强一致性来获得可用性，允许数据短时间内的不一致。

2. **原子提交与 2PC**：
   - **单节点事务原子性**：
     - 事务结果要么全部提交，要么全部回滚。
   - **2PC（两阶段提交）**：
     - 引入协调者和参与者角色。
     - 准备阶段和提交阶段，保证所有节点要么全部提交，要么全部中止。
     - 同步阻塞问题限制了系统性能。
     - 协调者单点故障可能导致长时间服务不可用。

3. **3PC（三阶段提交）**：
   - 将准备过程分为 CanCommit、PreCommit、DoCommit 三个阶段。
   - 降低参与者阻塞范围，在单点故障后保持一致。
   - 网络延迟可能导致节点假死误报，造成数据不一致。

4. **支持容错的共识**：
   - **Paxos**：
     - Basic Paxos 和 Multi-Paxos 两种算法。
     - Proposer、Acceptor 和 Learner 角色。
     - 通过提案编号和多数节点写入保证一致性。
     - Multi-Paxos 选举主 Proposer，避免提案死锁。
   - **Raft 与 Zab**：
     - 借鉴 Multi-Paxos，简化算法模型。
     - Raft 的 Leader 选举和数据同步机制。
     - Raft 被广泛用于 etcd、TiDB 等分布式数据库。

5. **拜占庭容错**：
   - **拜占庭将军问题**：
     - 描述分布式系统中消息不可靠现象。
     - 确保诚实节点在叛徒干扰下达成共识。
   - **POW（工作量证明）**：
     - 节点进行解谜，最先计算出结果的节点获得记账权。
     - 比特币网络中通过挖矿形式实现。
   - **POS（股权证明）**：
     - 使用数字货币作为股权抵押，根据股份和时间随机选择记账权持有者。
   - **DPOS（委托权益证明）**：
     - 节点将股权委托给代理人参与记账权争夺。

6. **总结**：
   - 文章介绍了分布式系统中重要的理论和共识算法。
   - 2PC、类 Paxos 和拜占庭容错算法分别解决了不同场景下的一致性问题。
   - 选择合适的共识算法对构建分布式系统至关重要。
   - 分布式领域仍有许多问题待解决，需要持续学习和研究。
