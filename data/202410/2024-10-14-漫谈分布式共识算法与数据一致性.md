# 漫谈分布式共识算法与数据一致性
- URL: https://wingsxdu.com/posts/algorithms/distributed-consensus-and-data-consistent/
- Added At: 2024-10-14 11:13:12
- [Link To Text](2024-10-14-漫谈分布式共识算法与数据一致性_raw.md)

## TL;DR
本文探讨了分布式系统中的共识与一致性难题，涵盖FLP和CAP定理、2PC/3PC协议、Paxos/Raft/Zab算法及拜占庭容错，指出这些问题是构建实用分布式系统的关键挑战。

## Summary
1. **共识与一致性**：
   - **不可靠的网络与时钟**：
     - 异步网络可能导致消息丢失或延迟。
     - 网络分区可能导致节点间无法通信。
     - 节点时钟可能存在偏差，影响事件排序。
     - 使用逻辑时钟比物理时钟更可靠。
   - **FLP 不可能定理**：
     - 在异步系统模型中，如果节点存在崩溃失效的风险，则不存在一个总是能够在有限时间内达成共识的确定性算法。
   - **CAP 定理**：
     - 在异步的网络模型中分布式系统的三个指标：一致性、可用性和分区容错性，当发生故障时，最多只能同时满足这三项中的两项。
   - **BASE 理论**：
     - 即使无法做到强一致性，但每个应用都可以根据自身业务特点，采用适当的方式来使系统达到最终一致性。

2. **原子提交与 2PC**：
   - **2PC**：
     - 两阶段提交是一种在多节点之间实现事务原子提交的共识算法。
     - 引入协调者和参与者角色。
     - 分为准备和提交两个阶段。
     - 可能存在协调者单点故障问题。
   - **3PC**：
     - 三阶段提交对两阶段提交进行了一定的改进，将准备过程一分为二，形成了 CanCommit、PreCommit、DoCommit 三个阶段。
     - 降低了参与者的阻塞范围，并且能够在出现单点故障后继续保持一致。

3. **支持容错的共识**：
   - **Paxos**：
     - 一种理论上的一致性解决方案。
     - 包含 Basic Paxos 和 Multi-Paxos 两种具体的共识算法。
     - Basic Paxos 可能存在提案死锁问题。
     - Multi-Paxos 通过选举主 Proposer 解决了 Basic Paxos 的问题。
   - **Raft 与 Zab**：
     - Raft 是一种通用的分布式共识算法。
     - Zab 是特别为 ZooKeeper 设计的支持崩溃恢复的原子广播协议。
     - 这两种算法的核心思路基本一致。

4. **拜占庭容错**：
   - **拜占庭将军问题**：
     - 描述分布式系统中的消息不可靠现象。
     - 恶意节点可能发送错误消息或选择性地发送消息。
   - **POW 与 POS**：
     - 工作量证明（POW）是一种防止服务滥用问题的算法。
     - 股权证明（POS）是一种用股权取代计算能力的算法。
     - 委托权益证明（DPOS）允许节点将自己的股权委托给一个代理人。

5. **总结**：
   - 分布式领域仍然有许多问题待需解决，处理这些问题不仅是一个持续活跃的研究领域，也是构建实用的分布式系统时的主要关注点。
