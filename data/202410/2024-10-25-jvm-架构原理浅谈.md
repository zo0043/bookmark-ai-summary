# JVM 架构原理浅谈
- URL: https://ddrandy.github.io/2022/04/07/jvm-abc/
- Added At: 2024-10-25 05:51:18
- [Link To Text](2024-10-25-jvm-架构原理浅谈_raw.md)

## TL;DR
JVM是执行Java字节码的虚拟机，支持跨平台。文章介绍了Java背景、类加载机制、运行时数据区、执行引擎及垃圾回收等核心概念，阐述了JVM如何实现高效运行和管理Java程序。

## Summary
1. **JVM 简介**：JVM（Java 虚拟机）是执行 Java 字节码的虚拟机，它是一套规范标准，由不同组织或公司实现，如 OpenJDK 和 Oracle 的商业化实现。

2. **Java 背景与特点**：Java 语言因其跨平台、面向对象等特性以及 WORA 设计理念而流行。Java 编译产物为操作平台无关的字节码格式 class 文件，通过 JVM 运行。

3. **类加载系统**：
   - **动态类加载机制**：JVM 运行后，通过类加载系统将 class 文件加载到内存。
   - **加载过程**：包括加载、链接、初始化。加载是从 class 文件到内存的过程，链接包括验证和准备类，初始化是执行类的初始化方法 `<clinit>`。

4. **类加载器**：
   - **三类加载器**：BootstrapClassLoader、ExtensionClassLoader、ApplicationClassLoader，它们遵循可见性、唯一性、委托原则。
   - **自定义类加载器**：开发者可以创建自定义类加载器，选择遵照或打破上述原则。

5. **链接过程**：
   - **校验**：确保 class 文件结构正确，包括符号表、方法重载、访问控制等检查。
   - **准备**：为类或接口创建静态字段并初始化为默认值。
   - **解析**：从运行时常量池中的直接引用替换符号引用。

6. **运行时数据区**：
   - **方法区**：存储每个类的结构，如运行时常量池、字段和方法数据，是线程共享的内存区域。
   - **堆**：存储所有对象及对应的实例变量和数组信息，是线程共享的内存区域，也是垃圾回收的重要区域。
   - **栈**：线程私有的内存区域，用于方法调用，存储栈帧，包括局部变量表、操作数栈、动态链接和方法返回地址。

7. **程序计数器**：线程私有的寄存器，保存当前执行指令的地址。

8. **本地方法栈**：线程私有的内存区域，用于存储 JNI 调用的本地方法信息。

9. **执行引擎**：
   - **解释器**：逐行解释字节码并执行。
   - **即时（JIT）编译器**：将字节码编译为本地代码，提高执行效率。

10. **垃圾回收**：销毁未引用的对象，回收内存。

11. **Java 本地接口（JNI）**：用于 JVM 调用 C/C++ 或其他编程语言编写的本地应用程序和库。

12. **本地方法库**：其他编程语言编写的库，可以通过 JNI 加载。
