# 分布式一致性协议 Raft 原理
- URL: https://wingsxdu.com/posts/algorithms/raft/
- Added At: 2024-10-14 11:14:19
- [Link To Text](2024-10-14-分布式一致性协议-raft-原理_raw.md)

## TL;DR
Raft是一种易于理解的分布式一致性协议，通过领导选举和日志复制确保节点状态一致。它支持非拜占庭错误，多数节点响应即可完成命令。随机选举超时避免选举死循环，日志匹配和一致性检查保障数据安全。

## Summary
1. **Raft简介**：Raft是一个基于消息传递通信模型的分布式一致性协议，旨在提供一个比Paxos更易于理解和实现的算法，确保即使在出现错误的情况下，一组机器也能像一个整体一样工作。

2. **数据一致性**：分布式系统中的节点通信存在两种模型：共享内存和消息传递。Raft是强一致性算法，确保所有节点以相同顺序接收相同指令，最终得到一致结果。

3. **状态机复制**：通过日志复制实现状态机复制，保证多个副本在运行时的状态同步，客户端无论请求哪个节点，都能得到相同结果。

4. **Raft特性**：
   - 确保非拜占庭条件下的安全性。
   - 只要超过一半服务器可以运行并通信，算法就可用。
   - 不依赖于时序来确保日志一致性。
   - 通常情况下，只要大多数服务器响应，命令就可以完成。

5. **领导选举**：Raft通过领导选举机制选举出一个Leader，由它全权管理日志复制来实现一致性。节点状态有Leader、Follower和Candidate三种。

6. **节点通信**：集群中的节点使用RPC进行通信，包括AppendEntries RPC、RequestVote RPC和InstallSnapshot RPC。

7. **选举流程**：Follower在一定时间内未收到消息会变成Candidate并发起选举，获得多数选票的Candidate将成为新的Leader。

8. **随机选举超时时间**：Raft使用随机选举超时时间机制来确保很少会发生选票瓜分的情况，避免集群陷入选举死循环状态。

9. **日志复制**：Leader将客户端请求作为日志条目附加到日志中，然后并行地向其他节点发起AppendEntries RPC，确保所有Follower最终都存储了所有日志条目。

10. **Log Matching**：Raft维护着日志匹配特性，确保不同服务器之间日志高层次的一致性。

11. **日志一致性检查**：Leader通过强制Follower复制自己的日志处理不一致问题，通过一致性检查机制，Follower日志在AppendEntries RPC时自动趋于一致。

12. **安全性**：Raft通过选举限制策略保证新Leader数据的新
