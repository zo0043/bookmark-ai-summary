# 解密JVM崩溃(Crash)：如何通过日志分析揭开神秘面纱
- URL: https://mp.weixin.qq.com/s/_DOQGBmhfV-LUzb03RcTCQ
- Added At: 2024-10-12 09:40:08
- [Link To Text](2024-10-12-解密jvm崩溃(crash)：如何通过日志分析揭开神秘面纱_raw.md)

## TL;DR
本文探讨了Java系统偶发性崩溃的挑战，详细解析了崩溃定义、示例、日志内容及core文件分析，总结了常见崩溃原因及应对经验，强调理解JVM机制和合理配置的重要性，以降低崩溃风险。

## Summary
1. **JVM崩溃概述**：本文探讨了使用Java构建复杂软件系统时，系统偶发性崩溃（Crash）的挑战。崩溃会对系统稳定性和可靠性产生负面影响，并影响用户体验。

2. **崩溃定义**：崩溃即系统挂掉，进程消失。研发人员需要像消防员一样迅速分析日志、检查堆栈并尝试重现问题。

3. **崩溃示例**：通过一个使用sun.misc.Unsafe类进行非法内存读取的代码示例，展示了崩溃的发生过程和虚拟机崩溃的日志提示。

4. **崩溃日志详解**：
   - **文件路径**：解释了崩溃日志文件的默认生成位置和命名规则，以及如何自定义文件路径。
   - **信息摘要**：概述了崩溃日志包含的信息，如崩溃原因、版本配置、线程信息、堆信息、本地库列表、命令行参数、环境变量、操作系统和CPU信息等。
   - **头部信息**：解释了崩溃原因、问题帧栈和核心转储文件的重要性。
   - **线程信息**：详细分析了线程类型、线程状态、信号量概要、寄存器内容、帧栈明细等。
   - **进程信息**：介绍了进程里的线程、虚拟机安全状态、锁和监视器、内存使用摘要和明细、GC辅助模型、CodeCache、事件分析等。
   - **内存映射明细**：解释了内存映射信息的内容和意义。
   - **启动参数和环境变量**：说明了Java进程启动参数和系统环境变量的重要性。
   - **信号处理**：介绍了虚拟机对信号的回调处理机制。
   - **系统信息**：概述了系统信息概要、系统内存概括、CPU信息概况等。

5. **core文件**：
   - **问题调用栈**：解释了如何使用gdb的bt命令查看崩溃时的函数调用历史。
   - **帧快照**：介绍了如何使用frame命令定位到特定的调用帧，并查看寄存器内容。
   - **汇编代码还原**：说明了如何使用disas命令还原出问题的汇编代码。
   - **内存映射**：解释了如何使用i proc m命令查看内存映射信息。

6. **经验总结**：
   - **虚拟机崩溃的原因分类**：总结了内存非法访问和物理内存不足两种常见的崩溃原因。
   - **留意JNI**：强调了在使用JNI时需要注意的问题，尤其是信号处理回调函数的注册。
   - **敢于怀疑**：建议在遇到极端问题时考虑Java虚拟机自身bug的可能性。

7. **总结**：本文深入探讨了JVM崩溃的各种细节及其解决方案，强调了理解和掌握JVM内在机制的重要性，以及如何通过合理的配置、监控工具和调优策略降低JVM崩溃的风险。
