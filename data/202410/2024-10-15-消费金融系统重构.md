# 消费金融系统重构
- URL: https://juejin.cn/post/7356550566535495732
- Added At: 2024-10-15 07:58:47
- [Link To Text](2024-10-15-消费金融系统重构_raw.md)

## TL;DR
文章介绍了因业务重组和技术债务引发的重构项目，通过调研、规划和采用修缮者模式，进行领域和模块设计，逐步上线新系统并完善监控，最终提升服务稳定性和开发效率，实现系统通用性和可移植性。

## Summary
1. **背景**
   - **业务重组与合并**：
     - 需求迭代导致消费分期调整，提出新产品方向。
     - 历史服务不适应未来规划，需新架构承载业务。
   - **解决技术债务**：
     - 代码模块边界不清，需模块拆分、服务拆分。
     - 代码层次感缺失，设计模式单一，微服务拆分未剥离基础功能，导致重复代码。
   - **影响开发效率**：
     - 问题排查费力，代码复杂，调用链路交错，难以维护。
   - **监控体系不完善**：
     - 线上异常机制不敏感，缺少关键业务指标告警。

2. **重构目标**
   - 不影响业务正常运转和迭代。
   - 改善代码结构设计，提升开发效率。
   - 采用新工程逐步替代旧接口，废弃旧工程。

3. **设计**
   - **调研**：
     - 调研互联网消金通用架构，借鉴分层架构设计。
   - **规划**：
     - 前后端分两次迭代进行，降低上线风险。
   - **修缮者模式**：
     - 第一次迭代：保留边缘逻辑，重构核心代码，新工程逐步接手。
     - 第二次迭代：新系统稳定后对接前端，V2版本上线。
   - **领域设计（横向拆分）**：
     - 聚合业务：涵盖主要业务，提供聚合接口。
     - 基础服务：提供数据支持。
     - 三方对接：灵活接入合作方接口。
   - **模块设计（纵向拆分）**：
     - 拆解分期购物流程，剥离金融服务属性功能。
     - 设计原则：单一职责和依赖倒置，明确职责，降低耦合。
   - **代码设计**：
     - 采用双层模板、策略、工厂模式组合。
     - 授信模块类图设计，定义接口与实现类。

4. **上线过程**
   - 采用新表结构，单向数据同步，逐步弃用老系统数据。
   - 灰度期间回滚优先保证服务稳定。

5. **监控**
   - 采用转转告警机制和Prometheus监控，搭建线上看板。
   - 合理日志记录，便于问题定位。

6. **总结**
   - 解决技术债务，提升服务稳定性和用户体验。
   - 重构是持续优化过程，需坚定信念和不懈努力。
   - 重构后系统具备通用性和可移植性，创造稳定可靠的“轮子”。
