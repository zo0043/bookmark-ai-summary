# 货拉拉—实时对账系统（算盘平台）
- URL: https://mp.weixin.qq.com/s?__biz=MzI0MjIxNjE0OQ==&mid=2247494056&idx=1&sn=1f5d9487a284d08edb3a7bab05664d42&scene=21#wechat_redirect
- Added At: 2024-12-19 10:00:06
- [Link To Text](2024-12-19-货拉拉—实时对账系统（算盘平台）_raw.md)

## TL;DR
货拉拉实时对账系统（算盘）解决大规模交易对账难题，实现秒级对账，填补货拉拉资金安全空白，未来将提升系统能力，共建资金安全屏障。

## Summary
1. **背景与挑战**
   - **业务增长**：货拉拉业务发展迅速，交易规模大，日单量峰值超百万，系统数量超过500个。
   - **对账困难**：传统对账方式难以应对大规模交易，微服务数据不一致和业务逻辑问题导致资损问题频发。
   - **资损问题**：资损问题隐蔽性强，难以发现和补救。

2. **分布式系统问题**
   - **一致性挑战**：分布式系统难以同时保证可用性、分区容忍性和一致性。
   - **数据不一致问题**：分布式系统间网络调用存在数据不一致问题，影响资金流转。

3. **方案设计**
   - **设计思路**：从数据本源入手，实时核对源数据和对比数据，判定准确性。
   - **中间件分区容错**：通过动态热分区方式转移风险，高吞吐量数据池化降低查询量。
   - **动态自适应集群**：动态集群划拨，加权负载均衡，算力buffer预留。
   - **系统安全性保障**：流量过载保护，异常任务自动熔断，线程池隔离，非法语法识别。

4. **对账流程**
   - **事件接入**：支持DBbinlog，MQ消息与API方式接入，支持事件采样率设置、限流配置等。
   - **数据核对**：事件数据经过解析、路由、过滤后，调用公共函数和三方数据源进行核对。
   - **结果处理**：对账结果打标、持久化，错账数据持久化，支持自动重试、重放，联动线上系统平账。

5. **总体方案设计**
   - **配置平台**：负责在线配置、调试、发布、集群管理，集群分配与自检。
   - **对账数据池**：对比数据配置解析、数据标准化、缓存与查询、数据池化处理。
   - **对账核心服务**：对账事件核对、延迟、重试、结果处理，持久化结果数据。

6. **使用情况**
   - **业务场景**：覆盖交易、计价、支付、履约、营销、会员等全业务场景。
   - **数据吞吐量**：对账消息源491个，对照消息源124个，在线对账脚本数840+，峰值对账任务20W+QPS。
   - **集群管理**：动态管理6个分区集群，可实时扩展。

7. **结语**
   - **系统建设**：货拉拉实时对账系统（算盘）实现秒级对账能力，填补了货拉拉在此领域的空白。
   - **未来展望**：提升系统能力，与业务方共建，打造资金安全屏障。
