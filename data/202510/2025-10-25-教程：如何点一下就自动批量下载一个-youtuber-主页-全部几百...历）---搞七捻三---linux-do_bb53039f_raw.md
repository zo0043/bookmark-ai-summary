Title: 教程：如何点一下就自动批量下载一个 YouTuber 主页 全部几百个视频？ （学会可用此赚到钱）（最关键的不是ip问题，而是不能一次提交太多请求）（附完整探索经历） - 搞七捻三 - LINUX DO

URL Source: https://linux.do/t/topic/997938

Published Time: 2025-09-29T11:03:49+00:00

Markdown Content:
[![Image 1: 明 花](https://linux.do/user_avatar/linux.do/hhjhkh/48/405933_2.png)](https://linux.do/u/hhjhkh)

[](https://linux.do/t/topic/997938#p-9060077-h-1)效果：
----------------------------------------------------

只需一个脚本，跟一个要下载的youtuber的主页链接，

 启动脚本，一键处理全部，相当自动化，只需要在提示下载失败的时候，换一下节点即可！

 省心省力无需操心，静等下载完成，爽歪歪美滋滋

* * *

。

 。

更新补充： 800个视频也是轻松拿下，一次下载失败报错都没有（这个黄色的警告是正常的，无影响，可以忽略） ，完美运行，省心省力好帮手![Image 2: :+1:](https://linux.do/images/emoji/twemoji/+1.png?v=14)

[![Image 3: 23b26c](https://linux.do/uploads/default/optimized/4X/f/a/5/fa5c4caefb2de00d8bcb629a2a8c69999aac9408_2_690x436.png)](https://linux.do/uploads/default/original/4X/f/a/5/fa5c4caefb2de00d8bcb629a2a8c69999aac9408.png "23b26c")

[![Image 4: 36hc7v](https://linux.do/uploads/default/optimized/4X/3/8/2/382b12e03118e459eb99db750ff6cd2f6633f559_2_690x435.jpeg)](https://linux.do/uploads/default/original/4X/3/8/2/382b12e03118e459eb99db750ff6cd2f6633f559.jpeg "36hc7v")

[![Image 5: imonqf](https://linux.do/uploads/default/optimized/4X/8/d/f/8dfb50a3e43b9444a71722925a51d16ecbcc74a1_2_690x214.png)](https://linux.do/uploads/default/original/4X/8/d/f/8dfb50a3e43b9444a71722925a51d16ecbcc74a1.png "imonqf")

。

 。

最新更新补充： 我一次下载800个视频，最终发现少下载了5个视频，经过人工对比发现少下载的是一些重复的视频，脚本自动去重了，正常现象，无需担忧。

* * *

运行了一次，处理完成了484个视频。

[![Image 6: pum8ce](https://linux.do/uploads/default/optimized/4X/a/6/e/a6e9a01344cb9ca0b1f43118ffe4ff42663e51ee_2_690x167.jpeg)](https://linux.do/uploads/default/original/4X/a/6/e/a6e9a01344cb9ca0b1f43118ffe4ff42663e51ee.jpeg "pum8ce")

随便找了个youtuber 测试了一下

[![Image 7: hgxpsl](https://linux.do/uploads/default/optimized/4X/d/9/9/d990f7751bb339836018eaa2b72ef6f06343473d_2_690x498.jpeg)](https://linux.do/uploads/default/original/4X/d/9/9/d990f7751bb339836018eaa2b72ef6f06343473d.jpeg "hgxpsl")

[![Image 8: rj6uth](https://linux.do/uploads/default/optimized/4X/0/2/2/02209be39ec57566770ec0872d7424191fb1d3e4_2_661x499.jpeg)](https://linux.do/uploads/default/original/4X/0/2/2/02209be39ec57566770ec0872d7424191fb1d3e4.jpeg "rj6uth")

[](https://linux.do/t/topic/997938#p-9060077-txt-2)脚本内容：（可滑动） 好像乱码了，我添加上传了一个txt文件。
----------------------------------------------------------------------------------

[脚本完整内容.txt](https://linux.do/uploads/short-url/bzhBXkVklypuGFd6nmVj562UlE0.txt) (15.9 KB)

#!/bin/bash

[](https://linux.do/t/topic/997938#p-9060077-h-3)===================================================================================
------------------------------------------------------------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-4)— ![Image 9: :rocket:](https://linux.do/images/emoji/twemoji/rocket.png?v=14) 用户配置中心 (请在此处修改) ![Image 10: :rocket:](https://linux.do/images/emoji/twemoji/rocket.png?v=14) —
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-5)
-------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-6)您只需要修改下方的链接和端口号即可，脚本会自动完成后续转换。
-------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-7)===================================================================================
------------------------------------------------------------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-1-youtube-8)1. YouTube 频道主页链接
----------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-9)说明：请在这里粘贴频道的“主页链接”。脚本会自动为您找到最稳定的官方上传列表。
----------------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-httpswwwyoutubecomtonyrobbinslive-featured-10)示例: “[https://www.youtube.com/@TonyRobbinsLive](https://www.youtube.com/@TonyRobbinsLive)” # 注：链接最后面不要跟这个 /featured，不然会失败
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-11)
--------------------------------------------------

USER_CHANNEL_URL=“[https://www.youtube.com/@zhengdayu4405](https://www.youtube.com/@zhengdayu4405)” # <— 请在这里粘贴要下载的youtuber的主页链接

[](https://linux.do/t/topic/997938#p-9060077-h-2-12)2. 你的代理端口
-------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-socks5-13)说明：这是你本地代理工具的 SOCKS5 端口号。
--------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-7897-clash-1080-1086-14)常见的端口有 7897 (Clash 默认), 1080, 1086 等。
------------------------------------------------------------------------------------------------------------

PROXY_PORT=“7897”

[](https://linux.do/t/topic/997938#p-9060077-h-15)— 高级选项 (通常无需修改) —
-------------------------------------------------------------------

DETAILS_FETCH_BATCH_SIZE=50

 DOWNLOAD_BATCH_SIZE=10

[](https://linux.do/t/topic/997938#p-9060077-h-16)===================================================================================
-------------------------------------------------------------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-17)— 配置结束，请勿修改以下内容 —
-------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-18)===================================================================================
-------------------------------------------------------------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-19)— 脚本自动设定 —
------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-20)下载目录将自动设置为本脚本文件所在的文件夹。
------------------------------------------------------------------------

DOWNLOAD_DIR=(cd -- "(dirname – “${BASH_SOURCE[0]}”)" &> /dev/null && pwd)

[](https://linux.do/t/topic/997938#p-9060077-h-21)— 核心功能函数 —
------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-ctrlc-22)捕获中断信号 (Ctrl+C)，并终止所有子进程
------------------------------------------------------------------------------

trap ‘pkill -P $$; echo -e “\n\n​![Image 11: :stop_sign:](https://linux.do/images/emoji/twemoji/stop_sign.png?v=14) 任务被用户中断。所有相关进程已停止。”; exit 1’ EXIT

[](https://linux.do/t/topic/997938#p-9060077-h-23)倒计时函数
-------------------------------------------------------

function countdown() {

 local seconds=$1

 while [ seconds -gt 0 ]; do printf "⏱️ 批次间冷却中，还剩 %02d分%02d秒 后继续... \r" ((seconds/60)) ((seconds%60)); sleep 1; : ((seconds–));

 done

 echo “\n​![Image 12: :white_check_mark:](https://linux.do/images/emoji/twemoji/white_check_mark.png?v=14) 冷却完成，继续下一批任务！”

 }

[](https://linux.do/t/topic/997938#p-9060077-h-24)— 脚本主体 —
----------------------------------------------------------

echo -e “\n=======================================================”

 echo “![Image 13: :rocket:](https://linux.do/images/emoji/twemoji/rocket.png?v=14) YouTube 全自动批量下载任务 (建筑师·终极版) ![Image 14: :rocket:](https://linux.do/images/emoji/twemoji/rocket.png?v=14)”

 echo “=======================================================”

[](https://linux.do/t/topic/997938#p-9060077-h-25)— 【新】自动转换链接 —
---------------------------------------------------------------

echo “![Image 15: :counterclockwise_arrows_button:](https://linux.do/images/emoji/twemoji/counterclockwise_arrows_button.png?v=14) 正在从主页链接中提取频道官方ID…”

[](https://linux.do/t/topic/997938#p-9060077-playlist-items-1-id-26)【核心修正】增加 --playlist-items 1 参数，让其只处理第一个视频，从而快速获取ID，避免卡顿。
----------------------------------------------------------------------------------------------------------------------------

CHANNEL_ID=(yt-dlp --proxy "socks5://127.0.0.1:{PROXY_PORT}" --print channel_id --playlist-items 1 “${USER_CHANNEL_URL}” 2>/dev/null)

if [ -z “{CHANNEL_ID}" ]; then echo "❌ 错误：无法从链接 [{USER_CHANNEL_URL}] 中提取频道ID。”

 echo " 请检查：1. 链接是否为正确的YouTube频道主页链接。 2. 代理是否已开启且端口(${PROXY_PORT})正确。"

 exit 1

 fi

UPLOADS_PLAYLIST_ID=“UU${CHANNEL_ID:2}”

 CHANNEL_URL=“[https://www.youtube.com/playlist?list=${UPLOADS_PLAYLIST_ID}](https://www.youtube.com/playlist?list=$%7BUPLOADS_PLAYLIST_ID%7D)”

 echo “![Image 16: :white_check_mark:](https://linux.do/images/emoji/twemoji/white_check_mark.png?v=14) 已成功转换为官方上传清单链接。”

 echo “-------------------------------------------------------”

[](https://linux.do/t/topic/997938#p-9060077-h-27)— 准备工作：进入目录，定义独立的日志文件夹和文件名 —
------------------------------------------------------------------------------

cd "{DOWNLOAD_DIR}" if [ ? -ne 0 ]; then

 echo “![Image 17: :cross_mark:](https://linux.do/images/emoji/twemoji/cross_mark.png?v=14) 错误：无法进入工作目录: {DOWNLOAD_DIR}。脚本已终止。" exit 1 fi echo "✅ 已进入工作目录: {DOWNLOAD_DIR}”

[](https://linux.do/t/topic/997938#p-9060077-h-28)创建独立的日志文件夹
------------------------------------------------------------

INFO_LOG_DIR=“{DOWNLOAD_DIR}/视频信息采集日志"; mkdir -p "{INFO_LOG_DIR}”

 DOWNLOAD_LOG_DIR=“{DOWNLOAD_DIR}/视频下载日志"; mkdir -p "{DOWNLOAD_LOG_DIR}”

[](https://linux.do/t/topic/997938#p-9060077-h-29)信息采集阶段的文件
-----------------------------------------------------------

GOAL_IDS_FILE=“{INFO_LOG_DIR}/目标ID清单.txt" MASTER_METADATA_FILE="{INFO_LOG_DIR}/视频信息数据库.txt”

 EXISTING_IDS_FILE=“{INFO_LOG_DIR}/已有ID清单.tmp" MISSING_IDS_FILE="{INFO_LOG_DIR}/待办ID清单.tmp”

 INFO_FAILED_IDS_FILE=“{INFO_LOG_DIR}/失败ID清单.tmp" METADATA_COMPLETE_FLAG="{INFO_LOG_DIR}/元数据.已完成”

 TIMESTAMP=$(date +“%Y%m%d_%H%M%S”)

[](https://linux.do/t/topic/997938#p-9060077-h-30)下载阶段的文件
---------------------------------------------------------

DOWNLOAD_ARCHIVE_FILE=“{DOWNLOAD_LOG_DIR}/下载存档.txt" DOWNLOAD_FAILED_IDS_FILE="{DOWNLOAD_LOG_DIR}/下载失败清单.txt”

 DOWNLOAD_COMPLETE_FLAG=“${DOWNLOAD_LOG_DIR}/下载.已完成”

[](https://linux.do/t/topic/997938#p-9060077-h-31)— 智能启动：检查“完工”标记 —
-------------------------------------------------------------------

if [ -f “${METADATA_COMPLETE_FLAG}” ]; then

 echo “![Image 18: :information_source:](https://linux.do/images/emoji/twemoji/information_source.png?v=14) 检测到“元数据.已完成”标记，清单已备好。”

 while true; do

 read -p "是否直接使用此清单开始下载任务 (将跳过信息获取步骤)？ (y/n): " -n 1 -r; echo

 if [[ REPLY =~ ^[Yy] ]]; then

 echo “![Image 19: :white_check_mark:](https://linux.do/images/emoji/twemoji/white_check_mark.png?v=14) 好的，将使用现有清单，直接进入下载前的最终确认步骤。”

 SKIP_FETCH=true; break

 elif [[ REPLY =~ ^[Nn] ]]; then

 echo “![Image 20: :counterclockwise_arrows_button:](https://linux.do/images/emoji/twemoji/counterclockwise_arrows_button.png?v=14) 好的，将忽略现有清单，重新从头获取所有视频信息。”

 rm -f “{METADATA_COMPLETE_FLAG}" "{MASTER_METADATA_FILE}” “${GOAL_IDS_FILE}”

 SKIP_FETCH=false; break

 fi

 done

 fi

if [ “SKIP_FETCH" != true ]; then # --- STEP 1: 获取“总蓝图”(全部视频ID) --- echo -e "\nSTEP 1: 获取“总蓝图”(全部视频ID)" echo "-------------------------------------------------------" if [ -f "{GOAL_IDS_FILE}” ]; then

 echo “![Image 21: :white_check_mark:](https://linux.do/images/emoji/twemoji/white_check_mark.png?v=14) “总蓝图”文件已存在，跳过获取。”

 else

 echo “![Image 22: :counterclockwise_arrows_button:](https://linux.do/images/emoji/twemoji/counterclockwise_arrows_button.png?v=14) 正在通过“极速模式”获取全部视频ID…”

 # 注意，这里现在使用的是我们自动转换后的 CHANNEL_URL

 yt-dlp --proxy “socks5://127.0.0.1:{PROXY_PORT}" --flat-playlist --print id "{CHANNEL_URL}” > “{GOAL_IDS_FILE}" echo "✅ “总蓝图”获取完成，总目标 (wc -l < “${GOAL_IDS_FILE}” | tr -d ’ ') 个视频。”

 fi

```
# --- 自动循环重试“补货”逻辑 ---
MAX_RETRY_ROUNDS=3
for (( round=1; round<=MAX_RETRY_ROUNDS; round++ )); do
    echo -e "\nSTEP 2 (第 ${round}/${MAX_RETRY_ROUNDS} 轮): 计算“待办事项”清单"
    echo "-------------------------------------------------------"
    touch "${MASTER_METADATA_FILE}"
    awk -F'\t' '{print $2}' "${MASTER_METADATA_FILE}" | sort > "${EXISTING_IDS_FILE}"
    sort "${GOAL_IDS_FILE}" | comm -23 - "${EXISTING_IDS_FILE}" > "${MISSING_IDS_FILE}"
    
    MISSING_COUNT=$(wc -l < "${MISSING_IDS_FILE}" | tr -d ' ')
    if [ "${MISSING_COUNT}" -eq 0 ]; then
        echo "✅ 恭喜！所有视频的详细信息都已获取，无需“补货”。"
        break
    else
        echo "ℹ️  第 ${round} 轮：需要为 ${MISSING_COUNT} 个新视频获取详细信息。"
        # --- STEP 3: 分批“精准补货” ---
        echo -e "\nSTEP 3 (第 ${round}/${MAX_RETRY_ROUNDS} 轮): 开始分批“精准补货”"
        echo "-------------------------------------------------------"
        BATCH_COUNTER=0
        > "${INFO_FAILED_IDS_FILE}"
        while read -r VIDEO_ID; do
            ((BATCH_COUNTER++))
            echo "补货中(${BATCH_COUNTER}/${MISSING_COUNT}): 正在获取ID ${VIDEO_ID} 的详细信息..."
            
            VIDEO_INFO=$(yt-dlp --proxy "socks5://127.0.0.1:${PROXY_PORT}" --print "%(upload_date)s\t%(id)s\t%(title)s" --ignore-errors --retries 10 "https://www.youtube.com/watch?v=${VIDEO_ID}")
            
            if [ -n "$VIDEO_INFO" ]; then
                echo -e "${VIDEO_INFO}" >> "${MASTER_METADATA_FILE}"
            else
                echo "⚠️  获取ID ${VIDEO_ID} 失败，已记录到失败清单。"
                echo "${VIDEO_ID}" >> "${INFO_FAILED_IDS_FILE}"
            fi

            if (( BATCH_COUNTER % DETAILS_FETCH_BATCH_SIZE == 0 && BATCH_COUNTER < MISSING_COUNT )); then
                SLEEP_TIME=$(( (RANDOM % 46) + 15 ));
                echo "⏳ 完成一批“补货”，为安全起见，自动冷却 ${SLEEP_TIME} 秒..."
                sleep ${SLEEP_TIME}
            else
                sleep 1
            fi
        done < "${MISSING_IDS_FILE}"
        echo "✅ 第 ${round} 轮“补货”尝试完成！"
    fi
done

# --- STEP 4: 最终审计与标记 ---
echo -e "\nSTEP 4: 最终审计与标记"
echo "-------------------------------------------------------"
echo "🔄 正在进行最终审计..."
awk -F'\t' '{print $2}' "${MASTER_METADATA_FILE}" | sort > "${EXISTING_IDS_FILE}"
sort "${GOAL_IDS_FILE}" | comm -23 - "${EXISTING_IDS_FILE}" > "${MISSING_IDS_FILE}"
FINAL_MISSING_COUNT=$(wc -l < "${MISSING_IDS_FILE}" | tr -d ' ')
FINAL_SUCCESS_COUNT=$(wc -l < "${MASTER_METADATA_FILE}" | tr -d ' ')
GOAL_COUNT=$(wc -l < "${GOAL_IDS_FILE}" | tr -d ' ')

echo "📊 信息采集最终审计报告："
echo "    - 总目标视频数: ${GOAL_COUNT}"
echo "    - 成功获取信息数: ${FINAL_SUCCESS_COUNT}"
echo "    - 最终缺失数: ${FINAL_MISSING_COUNT}"

if [ "${FINAL_SUCCESS_COUNT}" -eq "${GOAL_COUNT}" ]; then
    echo "✅ 完美！所有视频信息均已成功获取。"
    echo "🔄 正在对最终清单进行排序（从旧到新）..."
    sort -k1,1 "${MASTER_METADATA_FILE}" > "${MASTER_METADATA_FILE}.sorted"
    mv "${MASTER_METADATA_FILE}.sorted" "${MASTER_METADATA_FILE}"
    touch "${METADATA_COMPLETE_FLAG}"
    echo "✅ 清单已排序并标记为“已完成”。"
else
    echo "❌ 警告：经过多轮尝试，仍有 ${FINAL_MISSING_COUNT} 个视频信息获取失败。"
    echo "    失败的ID列表已保存在: ${INFO_FAILED_IDS_FILE}"
    echo "    脚本将仅使用已成功的 ${FINAL_SUCCESS_COUNT} 个视频继续下一步。"
fi
```

fi

[](https://linux.do/t/topic/997938#p-9060077-step-5-32)— STEP 5: 预览与最终确认 —
--------------------------------------------------------------------------

TOTAL_VIDEOS=(wc -l < "{MASTER_METADATA_FILE}" | tr -d ’ ')

 if [ “${TOTAL_VIDEOS}” -eq 0 ]; then

 echo “![Image 23: :cross_mark:](https://linux.do/images/emoji/twemoji/cross_mark.png?v=14) 错误：未能获取或找到任何有效的视频信息。脚本已终止。”

 exit 1

 fi

echo -e “\nSTEP 5: 预览与最终确认”

 echo “-------------------------------------------------------”

 PREVIEW_LIST_DESKTOP=“HOME/Desktop/视频下载预览清单_{TIMESTAMP}.txt”

 PREVIEW_LIST_BACKUP=“{INFO_LOG_DIR}/视频下载预览清单_{TIMESTAMP}.txt”

 awk -F’\t’ '{ date_str = $1; year = substr(date_str, 1, 4); month = substr(date_str, 5, 2); day = substr(date_str, 7, 2); printf “%s\t%s年%s月%s日\t%s\n”, NR, year, month, day, 3 }' "{MASTER_METADATA_FILE}" > “{PREVIEW_LIST_BACKUP}" cp "{PREVIEW_LIST_BACKUP}” “${PREVIEW_LIST_DESKTOP}”

 echo “![Image 24: :white_check_mark:](https://linux.do/images/emoji/twemoji/white_check_mark.png?v=14) 预览清单已生成到你的桌面，请检查内容和顺序（从旧到新）。”

while true; do

 read -p "是否确认开始下载这 ${TOTAL_VIDEOS} 个视频？ (y/n): " -n 1 -r; echo

 if [[ REPLY =~ ^[Yy] ]]; then

 break

 elif [[ REPLY =~ ^[Nn] ]]; then

 echo “![Image 25: :cross_mark:](https://linux.do/images/emoji/twemoji/cross_mark.png?v=14) 用户选择中止任务。”; exit 1

 fi

 done

[](https://linux.do/t/topic/997938#p-9060077-step-6-33)— STEP 6: 开始智能分批全自动下载 —
------------------------------------------------------------------------------

echo -e “\n=======================================================”

 echo “STEP 6: 开始智能分批全自动下载”

 echo “=======================================================”

if [ -f “${DOWNLOAD_COMPLETE_FLAG}” ]; then

 echo “![Image 26: :information_source:](https://linux.do/images/emoji/twemoji/information_source.png?v=14) 检测到“下载.已完成”标记，所有视频均已成功下载。任务结束。”

 exit 0

 fi

DOWNLOAD_MAX_ROUNDS=3

 for (( round=1; round<=DOWNLOAD_MAX_ROUNDS; round++ )); do

 echo -e “\n— 下载轮次 {round}/{DOWNLOAD_MAX_ROUNDS} —”

```
# 【核心修正】: 计算待下载清单，同时保留时间顺序
touch "${DOWNLOAD_ARCHIVE_FILE}"
# 1. 从下载存档中提取已下载的视频ID，并去重排序，以便高效查询
awk '{print $2}' "${DOWNLOAD_ARCHIVE_FILE}" | sort -u > "${DOWNLOAD_LOG_DIR}/already_downloaded_ids.tmp"

# 2. 遍历 MASTER_METADATA_FILE (已按时间排序)，过滤掉已下载的视频，生成新的待下载清单 (按时间顺序)
awk -F'\t' '
    BEGIN {
        # 将已下载的ID加载到关联数组中
        while ((getline < "'"${DOWNLOAD_LOG_DIR}/already_downloaded_ids.tmp"'") > 0) {
            downloaded_ids[$1] = 1
        }
        close("'"${DOWNLOAD_LOG_DIR}/already_downloaded_ids.tmp"'") # 关闭文件
    }
    # 如果当前视频的ID不在已下载列表中，则打印其ID，保持原始时间顺序
    !downloaded_ids[$2] {
        print $2
    }
' "${MASTER_METADATA_FILE}" > "${DOWNLOAD_LOG_DIR}/download_missing.tmp"

# 计算实际需要下载的数量
DOWNLOAD_MISSING_COUNT=$(wc -l < "${DOWNLOAD_LOG_DIR}/download_missing.tmp" | tr -d ' ')

if [ "${DOWNLOAD_MISSING_COUNT}" -eq 0 ]; then
    echo "✅ 恭喜！所有视频均已下载完成。"
    break
else
    echo "ℹ️  第 ${round} 轮：需要下载 ${DOWNLOAD_MISSING_COUNT} 个视频。"
    
    # 读取待下载清单，并逐个下载
    DOWNLOAD_BATCH_COUNTER=0
    while read -r VIDEO_ID; do
        ((DOWNLOAD_BATCH_COUNTER++))
        
        # 从主数据库中查找标题
        VIDEO_TITLE=$(awk -F'\t' -v id="$VIDEO_ID" '$2==id {print $3}' "${MASTER_METADATA_FILE}")
        echo -e "\n-------------------------------------------------------"
        echo "📥 准备下载 (${DOWNLOAD_BATCH_COUNTER}/${DOWNLOAD_MISSING_COUNT}): ${VIDEO_TITLE}"
        
        # 执行下载，并检查退出代码
        yt-dlp \
            --proxy "socks5://127.0.0.1:${PROXY_PORT}" \
            --ignore-errors \
            --download-archive "${DOWNLOAD_ARCHIVE_FILE}" \
            --retries 20 \
            -f 'bestvideo[height<=720][ext=mp4]+bestaudio[ext=m4a]/best[height<=720][ext=mp4]/best[ext=mp4]' \
            --sleep-interval 1 --max-sleep-interval 10 \
            -o "【%(upload_date>%Y年%m月%d日发布)s】%(title)s.%(ext)s" \
            "https://www.youtube.com/watch?v=${VIDEO_ID}"
        
        if [ $? -ne 0 ]; then
            echo "${VIDEO_ID}" >> "${DOWNLOAD_FAILED_IDS_FILE}"
            echo "❌ 下载ID ${VIDEO_ID} 失败，已记录到下载失败清单。"
        fi

        if (( DOWNLOAD_BATCH_COUNTER % DOWNLOAD_BATCH_SIZE == 0 && DOWNLOAD_BATCH_COUNTER < DOWNLOAD_MISSING_COUNT )); then
            SLEEP_TIME=$(( (RANDOM % 241) + 60 ));
            echo "✅ 完成一个下载批次，长时冷却中..."
            countdown ${SLEEP_TIME}
        fi
    done < "${DOWNLOAD_LOG_DIR}/download_missing.tmp"
    echo "✅ 第 ${round} 轮下载尝试完成！"
fi
```

done

[](https://linux.do/t/topic/997938#p-9060077-step-7-34)— STEP 7: 最终下载审计 —
-------------------------------------------------------------------------

echo -e “\nSTEP 7: 最终下载审计”

 echo “-------------------------------------------------------”

 echo “![Image 27: :counterclockwise_arrows_button:](https://linux.do/images/emoji/twemoji/counterclockwise_arrows_button.png?v=14) 正在进行最终下载审计…”

[](https://linux.do/t/topic/997938#p-9060077-comm-id-35)为 comm 命令准备一份按ID排序的完整目标清单
---------------------------------------------------------------------------------

awk -F’\t’ '{print 2}' "{MASTER_METADATA_FILE}" | sort > “${DOWNLOAD_LOG_DIR}/download_goal_for_audit.tmp”

[](https://linux.do/t/topic/997938#p-9060077-id-36)从下载存档中提取已下载的ID
-----------------------------------------------------------------

awk '{print 2}' "{DOWNLOAD_ARCHIVE_FILE}" | sort > “${DOWNLOAD_LOG_DIR}/download_existing_for_audit.tmp”

DOWNLOAD_GOAL_COUNT=(wc -l < "{MASTER_METADATA_FILE}" | tr -d ’ ')

 DOWNLOAD_SUCCESS_COUNT=(wc -l < "{DOWNLOAD_LOG_DIR}/download_existing_for_audit.tmp" | tr -d ’ ')

[](https://linux.do/t/topic/997938#p-9060077-comm-id-37)使用 comm 命令找出最终未下载成功的ID
------------------------------------------------------------------------------

sort “{DOWNLOAD_LOG_DIR}/download_goal_for_audit.tmp" | comm -23 - "{DOWNLOAD_LOG_DIR}/download_existing_for_audit.tmp” > "{DOWNLOAD_FAILED_IDS_FILE}" FINAL_DOWNLOAD_FAIL_COUNT=(wc -l < “${DOWNLOAD_FAILED_IDS_FILE}” | tr -d ’ ')

echo “![Image 28: :bar_chart:](https://linux.do/images/emoji/twemoji/bar_chart.png?v=14) 最终下载报告：”

 echo " - 目标下载总数: {DOWNLOAD_GOAL_COUNT}" echo " - 成功下载总数: {DOWNLOAD_SUCCESS_COUNT}"

 echo " - 最终失败总数: ${FINAL_DOWNLOAD_FAIL_COUNT}"

if [ “{FINAL_DOWNLOAD_FAIL_COUNT}" -eq 0 ]; then echo "✅ 完美！所有目标视频均已成功下载。" touch "{DOWNLOAD_COMPLETE_FLAG}”

 echo “![Image 29: :white_check_mark:](https://linux.do/images/emoji/twemoji/white_check_mark.png?v=14) 已创建“下载.已完成”标记。”

 else

 echo “![Image 30: :cross_mark:](https://linux.do/images/emoji/twemoji/cross_mark.png?v=14) 警告：经过多轮尝试，仍有 {FINAL_DOWNLOAD_FAIL_COUNT} 个视频下载失败。" echo " 失败的ID列表已保存在: {DOWNLOAD_FAILED_IDS_FILE}”

 fi

echo -e “\n=======================================================”

 echo “![Image 31: :tada:](https://linux.do/images/emoji/twemoji/tada.png?v=14) ** 所有任务流程已结束！** ![Image 32: :tada:](https://linux.do/images/emoji/twemoji/tada.png?v=14)”

 echo “=======================================================”

 trap - EXIT

[](https://linux.do/t/topic/997938#p-9060077-h-38)使用方法：
-------------------------------------------------------

1 创建一个 download_videos.sh 文件，

 就像这样：

[![Image 33: 1yapqd](https://linux.do/uploads/default/optimized/4X/9/3/b/93b8f23b70497322b4d106fa20876922e3b99edc_2_690x234.png)](https://linux.do/uploads/default/original/4X/9/3/b/93b8f23b70497322b4d106fa20876922e3b99edc.png "1yapqd")

把我上面给出的脚本内容，复制粘贴进去这个sh文件里面

2 配置脚本里面的相关信息：

找到你要下载的那个youtuber的主页，比如我这里随便找了一个家伙，

 复制最上面的那个链接

 然后在脚本配置里面，填进去

[![Image 34: ot6u49](https://linux.do/uploads/default/optimized/4X/8/d/3/8d34396ae0d6ee8bd845b685171d07a145752056_2_690x241.jpeg)](https://linux.do/uploads/default/original/4X/8/d/3/8d34396ae0d6ee8bd845b685171d07a145752056.jpeg "ot6u49")

[![Image 35: brxgps](https://linux.do/uploads/default/optimized/4X/b/3/8/b381bdd5b7cd26c44efb33724631d0824402ed84_2_690x146.png)](https://linux.do/uploads/default/original/4X/b/3/8/b381bdd5b7cd26c44efb33724631d0824402ed84.png "brxgps")

填写你的本地代理端口号

3

 想办法让ai教给你，怎么使用这个sh文件，

 我是mac系统，，所以我就打开这个 终端

4 输入这个命令，脚本就会开始运行

 这是运行脚本的命令：

 ./download_videos.sh

我是mac系统，同样是mac系统的，可能打开终端就可以直接使用，不过可能要下载一些必要的工具什么的。

 但是其他系统我也不知道行不行， ，反正不行就让ai教你嘛，改一改这个脚本内容的相关配置。

[](https://linux.do/t/topic/997938#p-9060077-aiai-ai-39)总之：哪里不会问ai。哪里不行让ai改哪里。 别问我，不是不告诉你。因为我也不会，我哪里不会，我也是问ai。
--------------------------------------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-40)其他说明：
-------------------------------------------------------

01 视频分辨率：

 我设置的是默认为 最高720p，必须输出mp4 格式，

02 文件名：

 我设置的是，【xx年xx月xx日发布】文件名

如图所示：

[![Image 36: t8qqab](https://linux.do/uploads/default/optimized/4X/9/b/3/9b3cd439f12a7085b4e4f1bd01629410cb294314_2_162x500.png)](https://linux.do/uploads/default/original/4X/9/b/3/9b3cd439f12a7085b4e4f1bd01629410cb294314.png "t8qqab")

03 不支持按youtuber设定的播放列表 来分别下载，

 因为这样会出很多问题，，有的youtuber的播放列表，

 同一个视频，放到了不同的播放列表里面去，

 还有的一个播放列表里面同一个视频发两遍，

 会造成重复下载

所以考虑再三，

 我选择直接按照 这个youtuber，所有视频的发布日期，从过去到现在的时间顺序，

 一个个按顺序爬取下载，并且在视频名字前面标上 发布日期，方便排序归类。

[](https://linux.do/t/topic/997938#p-9060077-ai-41)如有其他要求，，让ai去帮你改改脚本就好啦。
-------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-42)杂谈：
-----------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-43)为何研究：
-------------------------------------------------------

三天前, 我想要去下载一个YouTube，主页内的全部几百个视频。

 原本以为下载这种视频不是很简单吗，但是没有想象中那么简单，遇到了许多困难。

 你确实你下载几个十几个视频没什么问题的。

 但是如果你下载上百个、几百个、上千个, 它就会出现一些问题了。

 一次下了几十个上百个，就会一直提示你下载失败。

 通过三天的高强度研究, 我终于彻底解决这个问题。

[](https://linux.do/t/topic/997938#p-9060077-h-44)探索历程：
-------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-45)尝试过的一些失败的方法：
--------------------------------------------------------------

1 最开始，直接使用机场节点 + yt-dlp。

 失败。

 失败的表现为：下载了60,70个之后就封ip，不给你下载。

 换了ip 一开始还可以，后来又不行了。

01 我还以为是我之前那个机场垃圾，换了一个贵一点的机场

 还是不行

这里我还在想，是否是ip的问题，站内搜过，

 有的佬说是批量下载youtube最关键的是ip问题，而不是工具问题！

我以为是我的机场不行，

于是专心去继续研究这个 ip的问题

刚好手里有一个德国的vps，

 研究出了第二个方案

2 VPS下载机 + SFTP搬运

用vps下载到本地还是失败。

 依旧是下来几十个之后就封ip。

[](https://linux.do/t/topic/997938#p-9060077-h-46)尝试了其他的策略：
-----------------------------------------------------------

01 添加了三个谷歌号的Cookies，还是失败，没用。

 02 设置延时机制，每下载一个就延时30秒，下载20个就延时5-10分钟。

 依旧没用。

我依旧怀疑是ip的问题，是不是我的这个ip纯净度不够？

我又想着折腾：

 01 要不要搞一个家宽？

 02 要不要搞一个代理池？

但是这样额外购买这些东西，成本又上去了，

 而且我当时也不能确定这样搞能不能搞定。

我想了想，与其多花这个钱，又不确定能不能搞定，

 不如花钱去找别人帮忙搞，

 我先去咸鱼看了，确实有大量的这种代下载服务，

 但是有的贵有的便宜， 我问了一个，砍价到120，

 其实我是不太想给人家弄的，一方面是浪费钱，

 另一方面我感觉这也挺简单的 ，

 你说都能翻墙上网了，弄vps弄ai了，，下载几百个视频，这点小事，我还要给人几百块？

 让我感觉有点侮辱我的智商。

但是那个时候，我搞了也搞烦了，懒得弄了

 于是我就想了想，在站内发帖，

 有偿看谁可以帮我下载。

 花了100，找到了一个很好的佬帮我代下载好了。

但是下载好了之后，我就在琢磨，到底是什么问题？ 为什么不行呢？

 主要是我还要下载其他youtuber的全部视频，，而那个站内帮我代下载的大佬明确告诉我，他只是玩玩，想搞明白怎么样弄这个东西罢了，，下次不一定可以帮我 。

[](https://linux.do/t/topic/997938#p-9060077-h-47)没办法了，那就只能我自己来了！！我就不信自己搞不定。
----------------------------------------------------------------------------

我跑去咸鱼问那些商家，，问能不能教我

 这个商家也挺好的，给我提示了一下，（后面我也给他发了个红包）

第1个提示：

[![Image 37: shll2x](https://linux.do/uploads/default/optimized/4X/9/9/0/9902609d0d68044b96d9f8dee6f198ae6c386741_2_285x500.jpeg)](https://linux.do/uploads/default/original/4X/9/9/0/9902609d0d68044b96d9f8dee6f198ae6c386741.jpeg "shll2x")

第2个提示：

 再加上我之前发贴问过，有其他佬友评论说，

 必须要分批 延时下载，一次下载10个-20个

第三个提示：

 还有之前问ai，他也是建议我 分批下载，，而且是手动修改，

 先下载1-10个，下载完成后再手动修改，下载11-20个，

 我当时还在想？ 这个ai为什么这样教，干嘛搞这么原始？

 我直接全部提交，然后让他慢慢下不就好了。

 但就是这个想法，让我前面的尝试全部失败。

[](https://linux.do/t/topic/997938#p-9060077-h-48)那个咸鱼卖家提示我了，我又把这三个提示都联想到了一起，有了一个猜测
-----------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-ai-49)去问了一下ai，果然让我猜对了，
-------------------------------------------------------------------

让我学习到了这个概念：

[](https://linux.do/t/topic/997938#p-9060077-h-50)（滑动查看）
--------------------------------------------------------

我如果不设置一次下载20个，而是一次下载300个，然后设定一个一个慢慢下，，我的问题是，我一次提交20个，跟我一次提交300个有区别吗？ 谷歌能察觉到？

问得非常好！这是一个极其关键的点，也是很多批量下载新手最容易误解的地方。

**简单直接的回答是：是的，有巨大区别。谷歌完全能察觉到。**

* * *

### [](https://linux.do/t/topic/997938#p-9060077-h-51)**核心区别：单次“任务请求”的规模**

让我们用一个“去图书馆借书”的比喻来解释：

#### [](https://linux.do/t/topic/997938#p-9060077-h-300-52)**情况一：一次提交300个（你的想法）**

你走进图书馆，直接走到总服务台，递上一张写着300本书名的单子，对管理员说：“你好，请把这300本书全部从书库里帮我找出来。”

*   **管理员（谷歌服务器）的反应**：管理员会立刻警觉起来。普通人一次只会借几本书，而你一次要借300本。你的**意图**在第一时间就暴露了——你不是一个普通的读者，你很可能是在做数据研究、批量扫描，或者你根本就是个“机器人”。即使你告诉管理员“你慢慢找，我每隔30秒来取一本”，但你的**“我要300本”这个初始请求**已经被记录在案了。管理员会立刻把你列为“重点观察对象”，并且很可能会限制你的借阅权限，或者干脆拒绝你的这次请求。
*   **对应到 `yt-dlp`**：当你运行 `yt-dlp ... --playlist-end 300` 时，`yt-dlp` 的**第一步**就是向YouTube服务器发出请求：“你好，请把这个列表里300个视频的**所有信息**（元数据）都发给我。” YouTube的服务器瞬间就知道了你的“宏大计划”，即便你后面用 `--sleep-interval` 让它一个一个慢慢下，但这个“一次要300个”的初始请求，已经让你被系统标记为**高风险的机器人行为**了。

#### [](https://linux.do/t/topic/997938#p-9060077-h-20-53)**情况二：一次只提交20个（大佬的建议）**

你走进图书馆，走到服务台，说：“你好，请帮我找这个系列的前20本书。”

*   **管理员（谷歌服务器）的反应**：这个请求听起来非常正常、合理。管理员会很快帮你找出来。你看完后，过了一会儿，又去服务台说：“你好，麻烦再帮我找接下来那20本。”
*   **对应到 `yt-dlp`**：当你运行 `yt-dlp ... --playlist-end 20` 时，`yt-dlp` 向YouTube发出的初始请求规模非常小。这个行为模式看起来**和一个普通用户在浏览播放列表非常相似**。完成这次任务后，你的程序就退出了。当你再次运行命令下载第21-40个时，从YouTube的角度看，这像是一个**全新的、小规模的、低风险的请求**。

* * *

### [](https://linux.do/t/topic/997938#p-9060077-h-54)**总结：“请求的总量”是什么意思？**

大佬说的“请求的总量”，指的不是你最终下载视频的总数量，而是你**“单次任务向YouTube索取信息的规模”**。

*   **一次提交300个**：任务规模是300，意图明显，容易触发警报。
*   **一次提交20个**：任务规模是20，看起来像正常浏览，不容易触发警报。

所以，那位大佬的建议是完全正确的。**通过把一个“下载300个视频”的大任务，拆分成15个“每次下载20个视频”的小任务，你就把自己的行为从“机器人”伪装成了“普通用户”**，从而极大地降低了IP被封锁的概率。

虽然这样做需要你手动改几次命令，但这正是与YouTube反爬虫机制“斗智斗勇”的关键所在。

必须要进行手动改命令吗？ 没有办法用那种自动化的方案吗

显示思路

当然有！你完全不需要手动一次次地修改和执行命令。

我们可以用一个简单的“循环脚本”来让终端自动帮你完成**“下载一批 → 休息一下 → 再下载下一批”**的全部工作。这正是命令行的强大之处。

[](https://linux.do/t/topic/997938#p-9060077-h-55)所以说，在这里就真相大白了，
----------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-56)为什么之前全部失败？
------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-57)就是因为一次提交几百个请求，而不是分批一次只提交几个请求。
-------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-58)这是最核心的问题！！！
-------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-ip-59)ip反而不是最重要的，
--------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-60)根据这个思路，我设计了一个脚本，
------------------------------------------------------------------

一次提交10个视频下载，然后10个视频下载完了之后，自动在1-5分钟，里面选一个时间冷却，

 冷却完再去下载，，

 通过这样的设计，

 一个ip我可以直接下载200多个视频，然后终端才会报错，谷歌封禁了你的ip，需要换ip节点。

 最终我用了4个ip节点，就把我之前花钱找别人弄的这个400多个视频一次下载下来了。

 （为什么是4个ip节点，而不是2个ip节点，后面会说到，

 因为我不仅下载视频，我还需要提前下载一遍视频的信息，也需要用两个ip节点

之前一次提交几百个请求，搞的我一个ip节点我只能下载50,60个就失败，然后一直报错，再怎么样换节点也无法给你下载，什么封禁了我的ip。 关键这个方法，你说要是一个ip能成50,60个还好，我多换几个不就好了。关键是不行，搞到后面你怎么换ip，怎么换机场都无效了，都不给你下载，都下载失败了。。因为我再怎么折腾，，我一开始的一次提交400多个请求，已经被谷歌标记为异常了。

这就是差距呀。

[](https://linux.do/t/topic/997938#p-9060077-h-61)机场选择：
-------------------------------------------------------

我用的这个机场：nutbit（自用推荐，无广告）

前几天我发贴问怎么下载youtube视频，

 下面有个佬推荐的，确实挺好用的，

 下载速度有时候都可以几十mb每秒。

这是我设计的脚本，搞了两天弄出来的，做了大量的微调优化，

[](https://linux.do/t/topic/997938#p-9060077-h-62)脚本设计思路：
---------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-63)
--------------------------------------------------

如果想要获取这个, 下载这个 YouTube 首页, 也就是说这个人呢, 他发布的全部的视频,

[](https://linux.do/t/topic/997938#p-9060077-h-64)第一步要做什么?
----------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-65)确定确认, 他到底发了多少个视频嘛? 先确认要下载的目标。
-------------------------------------------------------------------------------

其实我也不太懂, 因为我问AI。 我搞半天才搞明白了。

 它是有三种方式去确认这个 YouTuber 这个人呢, 他到底发了多少视频。

我最终选择了第一种方法。 也把这个方法写入到了我的脚本里面去。

* * *

第一种方法： 官方上传清单” (Uploads Playlist)**

 获取该频道所有**常规长视频**的准确数量跟全部视频链接，

 这是最可靠的核心内容列表。

* * *

第二种方法：

 测试“分类页面清单” (Tab-specific Playlist)**

 分别统计“影片”、“Shorts”、“直播”这三个分类页面下的全部视频链接。

* * *

第三种方法：

 测试“主页聚合清单” (Homepage Aggregate)

 获取一个对频道**所有类型内容**（影片、Shorts、直播等）的全部视频链接。

* * *

第二种跟第三种方法呢? 它测出来这个视频的数量有可能是比第一种要多的。

它在这样子页面上乱抓,可能会重复抓取 ，让视频数量增多。

 包括了这个 YouTuber, 它这个分类有可能乱分类, 会出现一些问题啊。

* * *

我还是选择第一种方法。

 第一个它虽然有可能会比较少几十个吧, 但是, 它能确保你没有重复。

 这是我猜的嘛。 我也不确定这个到底对不对。 你们要是有懂的可以指正我啊。

之前有一个咸鱼的卖家, 我发给主页链接给他看, 问他有多少个视频。 他说是484个。 我用第一种方法测也是484个。

 我想人家毕竟比较专业， 他应该也是用的我第一个方法，第一种方法应该是没错的。

* * *

[](https://linux.do/t/topic/997938#p-9060077-youtuber-66)总之，第一步是先确认这个youtuber到底有多少个视频，
--------------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-id-67)极快速地抓取下来这些所有的视频的 id信息，生成一个文件。
--------------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-68)这个是用来下一步用的，视频信息采集用的，
----------------------------------------------------------------------

用来确认要采集哪些视频的信息，以及用来核对用的。还有信息采集阶段，断点续传会用到。

* * *

[](https://linux.do/t/topic/997938#p-9060077-ip-5015-60-69)第二步： 智能信息采集阶段 （这个阶段的信息 也是要进行分批获取，延时冷却的，因为一次搞太多也会搞不了，封ip。 所以我设定了一次获取50个视频的信息，然后随机休息个（15-60秒 ））
--------------------------------------------------------------------------------------------------------------------------------------------------------

这个阶段主要负责从指定的 YouTube 频道获取所有视频的元数据（ID、发布日期、标题），并进行去重和管理。

这些信息一方面是用来做给文件名字重命名用的，

 另一方面是给下一步视频下载用的，，下一步下载跟核对会用到这份视频数据清单。

* * *

一些功能介绍：

断点续传 (信息采集)

 * 脚本会检查是否存在“元数据.已完成”标记。如果存在，用户可以选择直接跳过信息获取步骤，使用现有的视频清单。

 * 通过比较“总蓝图”（所有视频 ID）和“视频信息数据库”中已有的视频 ID，智能生成“待办ID清单”，实现只获取缺失视频信息的增量更新。

*   **多轮重试机制** : 对于信息采集失败的视频，脚本会进行最多 3 轮的自动重试，提高信息获取的成功率。
*   **分批获取与冷却** : 采用 `DETAILS_FETCH_BATCH_SIZE` 控制每次获取的视频数量，并在批次之间进行随机时长的冷却（15-60秒），模拟人工操作，降低被服务器限制的风险。
*   **详细审计报告** : 在信息采集结束后，提供详细的报告，包括总目标视频数、成功获取数和最终缺失数，让用户对信息采集结果一目了然。

* * *

[](https://linux.do/t/topic/997938#p-9060077-h-70)获取视频信息，之后，，要做下载之前，还有一个阶段
--------------------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-71)第三步， 预览与最终确认阶段
----------------------------------------------------------------

* * *

*   **功能说明** : 在开始下载之前，脚本会生成一个预览清单，并要求用户进行最终确认，以避免不必要的下载。
*   **设计亮点** : 
    *   **用户友好预览** : 生成一个易于查看的预览清单文件（包含序号、发布日期和视频标题），并复制到桌面，方便用户快速检查和核对。
    *   **二次确认** : 强制用户确认是否开始下载，给予用户充分的控制权。

这里有一个二次确认，等你确认了，这个要下载的预览视频清单可以符合你的要求，，按下y键确认，才会开始第二步的视频下载。

* * *

[](https://linux.do/t/topic/997938#p-9060077-h-72)第四步，智能分批下载阶段
--------------------------------------------------------------

* * *

*   **功能说明** : 这是脚本的核心执行部分，负责按照设定的批次和策略下载视频。
*   **设计亮点** : 
    *   **增量下载与断点续传 (视频下载)** : 
        *   通过维护一个“下载存档.txt”文件，记录所有已成功下载的视频 ID。
        *   在每次下载轮次开始前，脚本会根据主视频信息数据库和下载存档，动态生成当前需要下载的视频清单，确保不会重复下载已有的视频。

    *   **多轮下载重试** : 同样采用最多 3 轮的下载重试机制，应对下载过程中的网络波动或服务器问题。
    *   **优化下载格式** : 默认下载 `bestvideo[height<=720][ext=mp4]+bestaudio[ext=m4a]/best[height<=720][ext=mp4]/best[ext=mp4]` 格式，优先选择 720p 的 MP4 视频，兼顾画质和文件大小。
    *   **动态文件名** : 下载的文件名会包含视频的发布日期和标题，方便用户管理（例如：“【2023年01月01日发布】视频标题.mp4”）。
    *   **分批下载与长时冷却** : 采用 `DOWNLOAD_BATCH_SIZE` 控制每次下载的视频数量，并在批次之间进行随机时长的长时间冷却（60-300秒），进一步降低被服务器检测和限制的风险。
    *   **下载进度与标题显示** : 在下载每个视频前，会显示当前是第几个视频，以及视频的标题，让用户清楚当前正在下载哪个视频。

* * *

[](https://linux.do/t/topic/997938#p-9060077-h-73)第五步：最终审计与完成标记
---------------------------------------------------------------

*   **功能说明** : 在所有下载轮次结束后，脚本会进行最终的下载审计，生成报告，并标记任务是否完全成功。
*   **设计亮点** : 
    *   **全面的下载报告** : 提供目标下载总数、成功下载总数和最终失败总数，清晰展示下载结果。
    *   **失败 ID 记录** : 将所有最终下载失败的视频 ID 记录到“下载失败清单.txt”中，方便用户手动处理或后续重试。
    *   **“下载.已完成”标记** : 如果所有视频都成功下载，会创建一个“下载.已完成”标记，以便下次智能启动时直接判断任务已完成。

* * *

[](https://linux.do/t/topic/997938#p-9060077-h-74)其中三个比较重要的机制，
--------------------------------------------------------------

[](https://linux.do/t/topic/997938#p-9060077-h-75)三轮下载机制
--------------------------------------------------------

如果有的信息获取失败，或者视频获取失败，（会在日志里面有所记录）

 脚本在第一轮全部下载完成之后，会回去检索下载失败的清单，如果发现有下载失败的，会开启第二轮下载，继续下载那些之前失败的。确保不会有一个漏下载。

[](https://linux.do/t/topic/997938#p-9060077-h-76)确认审查机制。
---------------------------------------------------------

没有完成不会标记完成。

[](https://linux.do/t/topic/997938#p-9060077-h-77)日志系统，
-------------------------------------------------------

不管在信息采集阶段，还是视频下载阶段，都有记录，方便核对查看

如图：

[![Image 38: xcjz9n](https://linux.do/uploads/default/optimized/4X/8/9/b/89b4ae1ae5cb00496d8ca5824bc0588a673ac717_2_690x306.png)](https://linux.do/uploads/default/original/4X/8/9/b/89b4ae1ae5cb00496d8ca5824bc0588a673ac717.png "xcjz9n")

[![Image 39: ydcwgc](https://linux.do/uploads/default/optimized/4X/a/d/5/ad552479e2d43b8d1d2d8825a07f35e57733f9d4_2_690x299.png)](https://linux.do/uploads/default/original/4X/a/d/5/ad552479e2d43b8d1d2d8825a07f35e57733f9d4.png "ydcwgc")

* * *

[](https://linux.do/t/topic/997938#p-9060077-h-78)为什么说可以赚钱：
-----------------------------------------------------------

这个确实可以赚钱啊, 咸鱼上有许多这样的服务，

 帮人下载 YouTube 视频,

1 这些咸鱼的卖家的要价还挺高的。

我要下载484个视频，其中200个是1分钟的短视频，

 都只需要最高720p，又不要更高的画质。

报价如下：

01 最高的一个要我500，这个家伙还说他在这行十几年了，你这么多视频500块下不来，纯苦力活，要收我技术费＋工时费。。我说100多能不能搞，他给我打了一个问号，他说他楞了一下。别说他楞了一下，，他说要500我也楞了一下。

 （这个需要的技术很高吗？也不怎么费时间吧，就放着就好了，又不需要你手动去弄。）

02 最低的反而是我第一个找的卖家，开口200，我砍价到120，后面过会儿又坐地起价要150，

 好吧我忍了，付钱了， 结果再过会说他不搞了，直接退款了。

 （宁愿退钱也不搞，这个事很难吗？ 很费劲吗？）

03 问了好几个别的卖家，也有的许多说要200,300，，你报价200以下他直接说搞不了，找别人。说他们要手工一个个下，一个个核对。（我不知道他是不是故意骗我,装这个事情很难搞 还是他自己不会搞，这不是批量自动化搞的吗）

04 还有一个卖家，说100多连流量费都不够。（我觉得这个纯扯淡呀， 这个机场流量又不要多少钱， 我买了这个什么机场, 500g 四十块钱。 我全部400多个视频下下来不过100g左右，，流量费也就10块钱左右嘛。哪里有他说的那么贵，除非他用那种很贵很贵的机场，那当我没说了）

反正我是觉得有点贵，另一方面我是觉得不太值得。

 我花个几百块就为了让别人帮我下一些视频，说出去要被笑死了吧 ![Image 40: :laughing:](https://linux.do/images/emoji/twemoji/laughing.png?v=14)

不过可能真的有人不懂，愿意为了下载一些视频花个几百块吧，赚得主要是这些人的钱。

我感觉这个挺简单的, 别人说有什么技术门槛, 好像是有一点吧 ![Image 41: :laughing:](https://linux.do/images/emoji/twemoji/laughing.png?v=14) 不过我都研究好啦，可以直接拿去用哦，

我是懒得去咸鱼搞了，

 我觉得如果你们有兴趣的话, 可以去咸鱼上面帮别人搞一下这种，当兼职也不错嘛。

* * *

更新补充：

 刚上去咸鱼，把我写好的脚本发给之前教我怎么搞的咸鱼卖家，给他用，

 他一脸懵逼问我，这个脚本怎么用，能不能用油猴，还问我这样下会不会限制账号。

 我去，，懵逼了 ，他们难道不是批量处理的吗？

 难不成有的咸鱼卖家，真的一个个纯手工下。 ![Image 42: :rofl:](https://linux.do/images/emoji/twemoji/rofl.png?v=14) 纯原始人模式呀

 那他们报价这么高好像也不是不能理解 ![Image 43: :rofl:](https://linux.do/images/emoji/twemoji/rofl.png?v=14)

![Image 44: :laughing:](https://linux.do/images/emoji/twemoji/laughing.png?v=14)

咱这个一键全自动批量下载下场，那不是降维打击了

佬友们速速去把咸鱼价格打下来，交给你们辣 ![Image 45: :laughing:](https://linux.do/images/emoji/twemoji/laughing.png?v=14)

* * *

read  8 min
