# 周刊（第24期）：sqlite并发读写的演进之路
- URL: https://www.codedump.info/post/20220904-weekly-24/
- Added At: 2025-10-28 04:03:15
- [Link To Text](2025-10-28-周刊（第24期）：sqlite并发读写的演进之路_raw.md)

## TL;DR
SQLite从B-tree到WAL机制，优化并发读写，提高性能，实现BEGIN CONCURRENT机制，解决一写全卡住问题。

## Summary
1. **SQLite并发读写演进**：
   - **概论**：SQLite底层数据存储基于B-tree，读写单位是页面，每个页面有唯一编号。
   - **B-Tree模块**：负责读取页面到内存，修改后标记为脏页面，页面管理器负责落盘。
   - **页面管理器**：负责内存中页面管理，包括加载、缓存、错误恢复和事务管理。
   - **Journal机制**：早期实现，存储事务修改前的页面内容，但存在“一写全卡住”问题。
   - **WAL机制**：引入WAL文件，事务修改先写入WAL，提高并发读写性能。
   - **WAL-2机制**：引入两个WAL文件，解决checkpoint时无法进行写事务的问题。
   - **BEGIN CONCURRENT机制**：实现多个写并发，通过非冲突事务管理减少冲突。

2. **SQLite存储引擎细节**：
   - **B-Tree算法模块**：负责逻辑修改，标记脏页面。
   - **页面管理器**：负责页面加载、缓存、错误恢复和事务管理。
   - **数据库文件**：存储数据库相关文件，修改最终落盘到数据库文件。

3. **SQLite并发读写优化**：
   - **Journal机制**：存储事务修改前的页面内容，但效率低。
   - **WAL机制**：提高并发读写性能，但存在checkpoint阻塞问题。
   - **WAL-2机制**：解决checkpoint阻塞问题，提高并发性能。
   - **BEGIN CONCURRENT机制**：实现多个写并发，减少冲突。

4. **其他**：
   - **SQLite B-Tree存储引擎演进**：包括journal文件备份机制和WAL实现。
   - **参考文章**：提供更多SQLite存储引擎细节的参考资料。
